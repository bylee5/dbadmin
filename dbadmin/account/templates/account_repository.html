<!DOCTYPE html>
{% extends 'base-account.html' %}
{% load static %}
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
    {% block content %}
	<!-- 검색/입력 span -->
	<span style="font-size: 12px;" type="button" class="badge badge-warning" data-toggle="collapse" data-target="#collapseSelect" aria-controls="collapseSelect">검색</span>
	<span style="font-size: 12px;" type="button" class="badge badge-danger" data-toggle="collapse" data-target="#collapseInsert" aria-controls="collapseInsert">입력</span>

	<!-- 로딩바 -->
	<div class="spinner-border spinner-border-sm text-dark" role="status" id="spinners" name="spinners">
		<span class="sr-only">Loading...</span>
	</div>

    <!-- 검색란 -->
    <div class="collapse show" id="collapseSelect" style="font-size: 12px;">
		<div class="card card-body mt-2 bg-light callout callout-warning">
			<h6>검색란</h6>
			<p>기본적으로 like 검색을 제공하고 있습니다.</p>

			<table class="1table table-sm text-center" style="table-layout: fixed">
				<tr class="bg-dark text-white">
					<th class="rounded-left">연관부서</th>
					<th class="">레파지토리 타입(구분)</th>
				    <th class="">레파지토리 명</th>
					<th class="">레파지토리 URL</th>
					<th class="">계정명</th>
					<th class="">비고</th>
					<th class="">Jira URL</th>
					<th class="rounded-right"></th>
				</tr>
				<tr>
					<form class="form-inline" onsubmit="return false" name="selectForm">
						{% csrf_token %}
						<td><input class="form-control form-control-sm" id="s_repository_team" name="s_repository_team" type="text" placeholder=""></td>
						<td><input class="form-control form-control-sm" id="s_repository_type" name="s_repository_type" type="text" placeholder=""></td>
						<td><input class="form-control form-control-sm" id="s_repository_name" name="s_repository_name" type="text" placeholder=""></td>
						<td><input class="form-control form-control-sm" id="s_repository_url" name="s_repository_url" type="text" placeholder=""></td>
						<td><input class="form-control form-control-sm" id="s_account_user" name="s_account_user" type="text" placeholder=""></td>
						<td><input class="form-control form-control-sm" id="s_info" name="s_info" type="text" placeholder=""></td>
						<td><input class="form-control form-control-sm" id="s_url" name="s_url" type="text" placeholder=""></td>
						<td><button id="search" class="btn btn-warning btn-sm">검색</button></td>
					</form>
				</tr>
			</table>
		</div>
    </div>

	<!-- 입력란 -->
	<div class="collapse small" id="collapseInsert" style="font-size: 12px;">
		<div class="card card-body mt-2 bg-light callout callout-danger">
			<h6>입력란</h6>
			<table class="mb-2">
				<tr>
					<td>
						<a>- 권한 직접입력을 할 경우에는, <b>반드시 ,</b>를 잘 사용해주세요. (ex. select, insert, update, execute)</a>
					</td>
					<td class="text-right align-bottom">
						<a>강제입력 <input type="checkbox" id="forceinsert_flag" name="forceinsert_flag" data-toggle="toggle" data-size="xs" data-style="ios" data-onstyle="danger"  data-offstyle="light" data-height="20" data-width="50" data-on="ON" data-off="Off"></a>
						<style>
						.toggle.ios, .toggle-on.ios, .toggle-off.ios { border-radius: 20rem; }
						.toggle.ios .toggle-handle { border-radius: 20rem; }
					</style>
					</td>
				</tr>
			</table>

			<table class="table table-sm text-center" style="1table-layout: fixed">
				<form class="form-inline" onsubmit="return false;" name="insertForm">
				{% csrf_token %}
				<tr class="bg-dark text-white">
					<th class="rounded-left">연관부서</th>
					<th class="">구분</th>
				    <th class="">레파지토리 명</th>
					<th class="">레파지토리 URL</th>
					<th class="">계정명</th>
					<th class="">Jira URL</th>
					<th class="">비고</th>
					<th class="rounded-right"></th>
				</tr>
				<tr class="">
					<td style="width: 10%"><input class="form-control form-control-sm" id="i_repository_team" name="i_repository_team" value="{{ i_repository_team }}" type="text"></td>
					<td style="width: 10%"><input class="form-control form-control-sm" id="i_repository_type" name="i_repository_type" value="{{ i_repository_type }}" type="text"></td>
					<td style="width: 10%"><input class="form-control form-control-sm" id="i_repository_name" name="i_repository_name" value="{{ i_repository_name }}" type="text"></td>
					<td style="width: 30%"><input class="form-control form-control-sm" id="i_repository_url" name="i_repository_url" value="{{ i_repository_url }}" type="text"></td>
					<td style="width: 10%"><input class="form-control form-control-sm" id="i_account_user" name="i_account_user" value="{{ i_account_user }}" type="text"></td>
					<td style="width: 10%"><input class="form-control form-control-sm" id="i_url" name="i_url" value="{{ i_url }}" type="text"></td>
					<td style="width: 12%"><input class="form-control form-control-sm" id="i_info" name="i_info" value="{{ i_info }}" type="text"></td>
					<td style="width: 8%">
						<button class="btn btn-outline-danger btn-sm" onclick="insertBox()" type="submit">입력</button>
						<input class="btn btn-outline-dark btn-sm" type="button" value="지우기" onClick="insertBox_del()">
					</td>
				</tr>
				</form>
			</table>
		</div>
	</div>

	<div class="board small" id="account_repository_list_ajax" style="font-size: 12px;"></div>


	<!-- Modal -->
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-xl" role="document">
			<div class="modal-content">

				<!-- Modal Header -->
				<div class="modal-header small">
					<!-- <h4 class="modal-title" id="myModalLabel">Modal title</h4> -->

					<!-- Nav tabs -->
					<ul class="nav nav-pills" role="tablist">
						<li>
							<a class="nav-link active btn-outline-dark" href="#updateTab" aria-controls="updateTab" role="tab" aria-selected="true" data-toggle="tab">수정</a>
						</li>
					</ul>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
				</div>

				<!-- Modal Body -->
				<div class="modal-body small">
					<div role="tabpanel">

						<!-- Modal Tab panes -->
						<div class="tab-content">

							<!-- Modal Update-->
							<div role="tabpanel" class="tab-pane active fade show" id="updateTab">
								<form class="" onsubmit="return false;" name="updateForm">
									{% csrf_token %}
									<!-- hidden value (pk) -->
									<!-- view에 조회 데이터 넘기기 및 페이징 처리 원위치 이동을 위해 구현-->
									<input class="form-control form-control-sm" id="s_repository_team" name="s_repository_team" type="hidden">
									<input class="form-control form-control-sm" id="s_repository_type" name="s_repository_type" type="hidden">
									<input class="form-control form-control-sm" id="s_repository_name" name="s_repository_name" type="hidden">
									<input class="form-control form-control-sm" id="s_repository_url" name="s_repository_url" type="hidden">
									<input class="form-control form-control-sm" id="s_account_user" name="s_account_user" type="hidden">
									<input class="form-control form-control-sm" id="s_url" name="s_url" type="hidden">
									<input class="form-control form-control-sm" id="s_info" name="s_info" type="hidden">

									<!-- hidden id (pk) -->
									<input class="form-control form-control-sm" id="id" name="id" type="hidden">

									<table class="table table-sm table-hover text-center">
										<tr class="">
											<td style="width: 20%" class="bg-dark text-white align-middle">생성일자</td>
											<td style="width: 80%"><input class="form-control form-control-sm" id="u_create_dt" name="u_create_dt" type="text" readonly></td>
										</tr>
										<tr>
											<td class="bg-dark text-white align-middle">연관부서</td>
											<td><input class="form-control form-control-sm" id="u_repository_team" name="u_repository_team" type="text"></td>
										</tr>
										<tr>
											<td class="bg-dark text-white align-middle">레파지토리 타입(구분)</td>
											<td><input class="form-control form-control-sm" id="u_repository_type" name="u_repository_type" type="text"></td>
										</tr>
										<tr class="">
											<td class="bg-dark text-white align-middle">레파지토리 명</td>
											<td><input class="form-control form-control-sm" id="u_repository_name" name="u_repository_name" type="text"></td>
										</tr>
										<tr>
											<td class="bg-dark text-white align-middle">레파지토리 URL</td>
											<td><input class="form-control form-control-sm" id="u_repository_url" name="u_repository_url" type="text"></td>
										</tr>
										<tr class="">
											<td class="bg-dark text-white align-middle">계정명</td>
											<td><input class="form-control form-control-sm" id="u_account_user" name="u_account_user" type="text"></td>
										</tr>
										<tr class="">
											<td class="bg-dark text-white align-middle">비고</td>
											<td><input class="form-control form-control-sm" id="u_info" name="u_info" type="text"></td>
										</tr>
										<tr>
											<td class="bg-dark text-white align-middle">Jira URL</td>
											<td><input class="form-control form-control-sm" id="u_url" name="u_url" type="text"></td>
										</tr>
									</table>
									<p class="text-right">수정 하시겠습니까?</p>

									<div class="modal-footer">
										<button class="btn btn-outline-primary btn-sm" onclick="updateBox()" type="submit">수정</button>
										<button type="" class="btn btn-sm btn-outline-danger" data-dismiss="modal">취소</button>
									</div>
								</form>
							</div>

						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- loading control -->
	<script>
	$(document).ready(function(){
    	$('#spinners').hide();
	})

	.ajaxStart(function(){
        $('#spinners').fadeIn(10);

	})

	.ajaxStop(function(){
		$('#spinners').fadeOut(10);
	});
	</script>

	<!-- Modal window option script -->
    <script>
    $('#myModal').on('show.bs.modal', function (event) {
        var button = $(event.relatedTarget);
		var id = button.data('id');
		var create_dt = button.data('create_dt');
		var repository_team = button.data('repository_team');
		var repository_type = button.data('repository_type');
		var repository_name = button.data('repository_name');
		var repository_url = button.data('repository_url');
		var account_user = button.data('account_user');
		var url = button.data('url');
		var info = button.data('info');

		var s_repository_team = $("#s_repository_team").val();
		var s_repository_type = $("#s_repository_type").val();
		var s_repository_name = $("#s_repository_name").val();
		var s_repository_url = $("#s_repository_url").val();
		var s_account_user = $("#s_account_user").val();
		var s_url = $("#s_url").val();
		var s_info = $("#s_info").val();

        var modal = $('#updateTab')

		modal.find('#id').val(id);
		modal.find('#u_create_dt').val(create_dt);
		modal.find('#u_repository_team').val(repository_team);
		modal.find('#u_repository_type').val(repository_type);
		modal.find('#u_repository_name').val(repository_name);
		modal.find('#u_repository_url').val(repository_url);
		modal.find('#u_account_user').val(account_user);
		modal.find('#u_url').val(url);
		modal.find('#u_info').val(info);

		modal.find('#s_repository_team').val(s_repository_team);
		modal.find('#s_repository_type').val(s_repository_type);
		modal.find('#s_repository_name').val(s_repository_name);
		modal.find('#s_repository_url').val(s_repository_url);
		modal.find('#s_account_user').val(s_account_user);
		modal.find('#s_url').val(s_url);
		modal.find('#s_info').val(s_info);
    })
    </script>

	<!-- account insert ajax script -->
	<script>
	function insertBox() {
		var retVal = confirm("입력하시겠습니까?");
		if (retVal == true ){
			insert_callMoreListAjax();
		}else{
			return false;
		}
	}

	function insertBox_del() {
		document.insertForm.reset();
	}

	function insert_callMoreListAjax() {
		var i_repository_team = $("#i_repository_team").val();
		var i_repository_type = $("#i_repository_type").val();
		var i_repository_name = $("#i_repository_name").val();
		var i_repository_url = $("#i_repository_url").val();
		var i_account_user = $("#i_account_user").val();
		var i_url = $("#i_url").val();
		var i_info = $("#i_info").val();

		var s_repository_team = $("#s_repository_team").val();
		var s_repository_type = $("#s_repository_type").val();
		var s_repository_name = $("#s_repository_name").val();
		var s_repository_url = $("#s_repository_url").val();
		var s_account_user = $("#s_account_user").val();
		var s_url = $("#s_url").val();
		var s_info = $("#s_info").val();

		$.ajax( {
			type : 'POST',
			url: "{% url 'account_repository_insert' %}",
			data: {
				'i_repository_team': i_repository_team,
				'i_repository_type': i_repository_type,
				'i_repository_name': i_repository_name,
				'i_repository_url': i_repository_url,
				'i_account_user': i_account_user,
				'i_url': i_url,
				'i_info': i_info,
				's_repository_team': s_repository_team,
				's_repository_type': s_repository_type,
				's_repository_name': s_repository_name,
				's_repository_url': s_repository_url,
				's_account_user': s_account_user,
				's_url': s_url,
				's_info': s_info,
				'csrfmiddlewaretoken': token,
			},
			success: addMoreAccountRepositoryAjax,
			dataType: 'html'
		});
	}

	</script>

	<!-- account update ajax script -->
	<script>
		function updateBox() {
			update_callMoreListAjax();
			$('#myModal').modal("hide");
		}

		function update_callMoreListAjax() {
			var u_id = $("#id").val();
			var u_repository_team = $("#u_repository_team").val();
			var u_repository_type = $("#u_repository_type").val();
			var u_repository_name = $("#u_repository_name").val();
			var u_repository_url = $("#u_repository_url").val();
			var u_account_user = $("#u_account_user").val();
			var u_url = $("#u_url").val();
			var u_info = $("#u_info").val();

			var s_repository_team = $("#s_repository_team").val();
			var s_repository_type = $("#s_repository_type").val();
			var s_repository_name = $("#s_repository_name").val();
			var s_repository_url = $("#s_repository_url").val();
			var s_account_user = $("#s_account_user").val();
			var s_url = $("#s_url").val();
			var s_info = $("#s_info").val();

			$.ajax( {
				type : 'POST',
				url: "{% url 'account_repository_update' %}",
				data: {
					'u_id': u_id,
					'u_repository_team': u_repository_team,
					'u_repository_type': u_repository_type,
					'u_repository_name': u_repository_name,
					'u_repository_url': u_repository_url,
					'u_account_user': u_account_user,
					'u_url': u_url,
					'u_info': u_info,
					's_repository_team': s_repository_team,
					's_repository_type': s_repository_type,
					's_repository_name': s_repository_name,
					's_repository_url': s_repository_url,
					's_account_user': s_account_user,
					's_url': s_url,
					's_info': s_info,
					'csrfmiddlewaretoken': token,
				},
				success: addMoreAccountRepositoryAjax,
				dataType: 'html'
			});
		}
	</script>

	<!-- account select ajax script -->
	<script>
		var token = $('input[name="csrfmiddlewaretoken"]').prop('value');

		$('#search').click(function(){
			callMoreListAjax();
		});

        $('#account_repository_list_ajax').load('dummy',function(){
            callMoreListAjax();
        });

		function callMoreListAjax() {
			var s_repository_team = $("#s_repository_team").val();
			var s_repository_type = $("#s_repository_type").val();
			var s_repository_name = $("#s_repository_name").val();
			var s_repository_url = $("#s_repository_url").val();
			var s_account_user = $("#s_account_user").val();
			var s_url = $("#s_url").val();
			var s_info = $("#s_info").val();

			$.ajax( {
				type : 'POST',
				url: "{% url 'account_repository_select' %}",
				data: {
					's_repository_team': s_repository_team,
					's_repository_type': s_repository_type,
					's_repository_name': s_repository_name,
					's_repository_url': s_repository_url,
					's_account_user': s_account_user,
					's_url': s_url,
					's_info': s_info,
					'csrfmiddlewaretoken': token,
				},
				success: addMoreAccountRepositoryAjax,
				dataType: 'html'
			});
		}
	</script>

	<!-- common ajax script -->
    <script>
		function addMoreAccountRepositoryAjax(data, textStatus, jqXHR) {
			$('#account_repository_list_ajax').html(data);
		}
	</script>

    {% endblock %}
</body>
</html>
